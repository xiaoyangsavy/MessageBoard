<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<!-- meta使用viewport以确保页面可自由缩放 -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 引入 jQuery Mobile 样式 -->
<link rel="stylesheet" type="text/css" href="../css/jquery.mobile-1.4.5.min.css">
<link rel="stylesheet" type="text/css" href="../css/login.css">
<!-- 引入 jQuery 库 -->
 <script type="text/javascript" src="../js/jquery.min.js"></script>
<!-- 引入 jQuery Mobile 库 -->
 <script type="text/javascript" src="../js/jquery.mobile-1.4.5.min.js"></script>
 <!-- 引入项目公共逻辑库 -->
 <script type="text/javascript" src="../js/common.js"></script>
</head>
<body>

<div data-role="page">
  <div data-role="header" data-position="fixed">
    <a id="addmessage-button" onclick="goWebpage('addMessage.html')" class="ui-btn ui-corner-all ui-shadow ui-icon-action ui-btn-icon-left">发布</a>
    <h1>留言板</h1>
    <a onclick="goWebpage('select.html')" class="ui-btn ui-corner-all ui-shadow ui-icon-search ui-btn-icon-left">搜索</a>
    
  </div>

  <div data-role="main" class="ui-content">
   <ul class="ui-listview ui-listview-inset ui-corner-all ui-shadow" id="listview" data-role="listview" data-inset="true">
      <li data-role="list-divider">用户1  </li>   
      <li><a onclick="goWebpage('../messageDetail.html')">   
        <h2>辽宁大学</h2>
        <p><b>20190418</b></p>
        <p>辽宁大学信息学院座落于古朴厚重的崇山校区，现有用房总建筑面积8000余平方米，使用面积所属总计约5417平方米。学院前身为计算机科学系，于1984年在数学系计算数学专业基础上成立，设有计算机应用技术和计算机软件2个专业；1986年，计算机科学系与物理系计算机应用研究所合并成立计算机科学与技术系；1999年10月18日，学校以计算机科学与技术系、电子科学与工程系为主体，整合工商管理学院信息管理与信息技术专业组建信息科学与技术学院，时任国家领导人王文元同志亲笔题写院名；2007年更名为辽宁大学信息学院。多年来，学院秉承“明德精学 笃行致强”校训精神，以学科建设为龙头，以提高教学质量为核心，以社会化需求为导向，以人才培养为宗旨，不断调整课程结构、完善教学体系，为社会输出大量专业技术人才，获得了很好的社会效应。</p>
        <p class="ui-li-aside">已回复</p></a>
      </li>
      <li data-role="list-divider">用户2  </li>   
      <li><a onclick="goWebpage('../messageDetail.html')">   
       <h2>辽宁大学</h2>
        <p><b>20190418</b></p>
        <p>辽宁大学信息学院座落于古朴厚重的崇山校区，现有用房总建筑面积8000余平方米，使用面积所属总计约5417平方米。学院前身为计算机科学系，于1984年在数学系计算数学专业基础上成立，设有计算机应用技术和计算机软件2个专业；1986年，计算机科学系与物理系计算机应用研究所合并成立计算机科学与技术系；1999年10月18日，学校以计算机科学与技术系、电子科学与工程系为主体，整合工商管理学院信息管理与信息技术专业组建信息科学与技术学院，时任国家领导人王文元同志亲笔题写院名；2007年更名为辽宁大学信息学院。多年来，学院秉承“明德精学 笃行致强”校训精神，以学科建设为龙头，以提高教学质量为核心，以社会化需求为导向，以人才培养为宗旨，不断调整课程结构、完善教学体系，为社会输出大量专业技术人才，获得了很好的社会效应。</p>
        <p class="ui-li-aside">已回复</p></a>
      </li>
    </ul>
  </div>

  <div data-role="footer" data-position="fixed">
   
   <!-- 使按钮居中显示  -->
    <table style="margin: 0 auto">
    <tr><td align="center">
      <a href="#" class="ui-btn ui-icon-arrow-l ui-btn-icon-left ui-corner-all ui-shadow">上一页</a>
	  </td> <td align="center">
      <a href="#" class="ui-btn ui-icon-arrow-r ui-btn-icon-right ui-corner-all ui-shadow">下一页</a>
	   </td></tr>
     </table>
    
   <div data-role="navbar">
      <ul>
        <li><a href="#" data-icon="home" class="ui-btn-active ui-state-persist "></a></li>
        <li><a onclick="goWebpage('setting.html')" href="setting.html" data-icon="gear" ></a></li>
      </ul>
    </div>
  </div>
</div> 


 <script type="text/javascript">
$(function(){
 //查找用户权限
   $.ajax({
        type: "GET",
        url:  serverUrl+"user/getPermission?userName="+getUsername(),
        contentType: "application/json",
        success: function (data) {
			console.log("call user/getPermission");
			console.log(data);
	 		if(data.status==200){	//调用成功
			console.log("getPermission:");
			console.log(data.data);
			if(data.data==0){	//用户
				$("#addmessage-button").show();//显示发布按钮
			}else{
				$("#addmessage-button").hide();//隐藏发布按钮
			}
			}else{
				openPopup("权限获取失败，请重新登录！");
			}
        },
        error: function (e) {
			console.log(e);
            openPopup("权限获取失败，请重新登录！");
        }
    });	 
 
 //查询留言数据
    $.ajax({
        type: "GET",
        url:  serverUrl+"message/selectMessage",
        contentType: "application/json",
        success: function (data) {
            console.log("call message/selectMessage");
            console.log(data);
            if(data.status==200){	//调用成功
			console.log("接口数据长度："+data.data.length);
                 var html = "";
   			 for(var i = 0,len = data.data.length; i < len; i++){
				console.log(data.data[i]);
			 	var item = data.data[i];
			  	html += '<li class="ui-li-divider ui-bar-inherit ui-first-child" data-role="list-divider">'+item.userId+'</li>';
			  	html += '<li><a onclick="goMessageDetail('+item.messageId+')" class="ui-btn ui-btn-icon-right ui-icon-carat-r"> ';
			  	html += '<h2>'+item.messageTitle+'</h2>'; 
			  	html += '<p><b>'+item.messageDate+'</b></p>'; 
        	  	html += '<p>'+item.messageContent+'</p>'; 
       			html += '<p class="ui-li-aside">'+(item.isReplay==1?"已回复":"未回复")+'</p>'; 
        		html += '</a></li>'; 
			 }
				 document.getElementById("listview").innerHTML = html;
				
            }else{
                openPopup("获取数据失败，请重试！");
            }
        },
        error: function (e) {
            console.log(e);
            openPopup("获取数据失败，请重试！");
        }
    });

});
  </script>

</body>
</html>
